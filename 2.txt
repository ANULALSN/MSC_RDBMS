-- Create the database
CREATE DATABASE COMPANY;
USE COMPANY;

-- Create DEPARTMENT table first (no dependencies)
CREATE TABLE DEPARTMENT(
    DNAME VARCHAR(10) NOT NULL UNIQUE,
    DNUMBER INT PRIMARY KEY,
    MANAGERID INT,
    MGR_START_DATE DATE NOT NULL
);

-- Create EMPLOYEE table (depends on DEPARTMENT)
CREATE TABLE EMPLOYEE (
    NAME VARCHAR(10) NOT NULL,
    EMPLOYEEID INT PRIMARY KEY,
    BIRTHDATE DATE,
    HOUSENAME VARCHAR(20),
    GENDER CHAR(1),
    SALARY DECIMAL(10,2) CHECK(SALARY BETWEEN 5000 AND 25000),
    SUPER_EID INT,
    DNUMBER INT,
    FOREIGN KEY (SUPER_EID) REFERENCES EMPLOYEE(EMPLOYEEID),
    FOREIGN KEY (DNUMBER) REFERENCES DEPARTMENT(DNUMBER)
);

-- Create DEPTLOCATIONS table (depends on DEPARTMENT)
CREATE TABLE DEPTLOCATIONS(
    DNUMBER INT,
    DLOCATION VARCHAR(50),
    PRIMARY KEY(DNUMBER, DLOCATION),
    FOREIGN KEY (DNUMBER) REFERENCES DEPARTMENT(DNUMBER)
);

-- Create PROJECT table (depends on DEPARTMENT)
CREATE TABLE PROJECT(
    PNAME VARCHAR(10) NOT NULL,
    PNUMBER INT PRIMARY KEY,
    PLOCATION VARCHAR(20),
    DNUMBER INT NOT NULL,
    FOREIGN KEY (DNUMBER) REFERENCES DEPARTMENT(DNUMBER)
);

-- Create WORKS_ON table (depends on EMPLOYEE and PROJECT)
CREATE TABLE WORKS_ON(
    EMPLOYEEID INT,
    PNUMBER INT,
    HOURS INT NOT NULL,
    PRIMARY KEY(EMPLOYEEID, PNUMBER),
    FOREIGN KEY (EMPLOYEEID) REFERENCES EMPLOYEE(EMPLOYEEID),
    FOREIGN KEY (PNUMBER) REFERENCES PROJECT(PNUMBER)
);

-- Create DEPENDENT table (depends on EMPLOYEE)
CREATE TABLE DEPENDENT(
    EMPLOYEEID INT,
    DEPENDNAME VARCHAR(10) NOT NULL,
    SEX CHAR(1),
    BIRTHDATE DATE,
    RELATIONSHIP VARCHAR(20),
    PRIMARY KEY(EMPLOYEEID, DEPENDNAME),
    FOREIGN KEY (EMPLOYEEID) REFERENCES EMPLOYEE(EMPLOYEEID)
);

-- Add the MANAGERID foreign key constraint to DEPARTMENT
ALTER TABLE DEPARTMENT 
ADD CONSTRAINT FK_MANAGER 
FOREIGN KEY(MANAGERID) REFERENCES EMPLOYEE(EMPLOYEEID);